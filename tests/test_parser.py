import pytest
from weather_app.src.data_parser import Parser


@pytest.fixture
def parsed():
    return Parser({'latitude': 32.8125, 'longitude': 35.0, 'generationtime_ms': 0.05555152893066406, 'utc_offset_seconds': 7200, 'timezone': 'Asia/Jerusalem', 'timezone_abbreviation': 'GMT+2', 'elevation': 32.0, 'hourly_units': {'time': 'iso8601', 'relative_humidity_2m': '%', 'cloud_cover': '%'}, 'hourly': {'time': ['2025-01-21T00:00', '2025-01-21T01:00', '2025-01-21T02:00', '2025-01-21T03:00', '2025-01-21T04:00', '2025-01-21T05:00', '2025-01-21T06:00', '2025-01-21T07:00', '2025-01-21T08:00', '2025-01-21T09:00', '2025-01-21T10:00', '2025-01-21T11:00', '2025-01-21T12:00', '2025-01-21T13:00', '2025-01-21T14:00', '2025-01-21T15:00', '2025-01-21T16:00', '2025-01-21T17:00', '2025-01-21T18:00', '2025-01-21T19:00', '2025-01-21T20:00', '2025-01-21T21:00', '2025-01-21T22:00', '2025-01-21T23:00'], 'relative_humidity_2m': [79, 84, 85, 85, 86, 86, 81, 78, 70, 57, 49, 42, 40, 38, 34, 35, 56, 63, 68, 69, 71, 72, 76, 60], 'cloud_cover': [42, 20, 6, 2, 98, 100, 44, 100, 100, 100, 100, 100, 100, 23, 0, 0, 0, 0, 0, 0, 11, 63, 100, 100]}, 'daily_units': {'time': 'iso8601', 'temperature_2m_max': '°C', 'temperature_2m_min': '°C', 'uv_index_max': ''}, 'daily': {'time': ['2025-01-21'], 'temperature_2m_max': [21.3], 'temperature_2m_min': [12.1], 'uv_index_max': [4.2]}})

def test_parser_init(parsed):
    assert parsed.hourly_data == {'time': ['2025-01-21T00:00', '2025-01-21T01:00', '2025-01-21T02:00', '2025-01-21T03:00', '2025-01-21T04:00', '2025-01-21T05:00', '2025-01-21T06:00', '2025-01-21T07:00', '2025-01-21T08:00', '2025-01-21T09:00', '2025-01-21T10:00', '2025-01-21T11:00', '2025-01-21T12:00', '2025-01-21T13:00', '2025-01-21T14:00', '2025-01-21T15:00', '2025-01-21T16:00', '2025-01-21T17:00', '2025-01-21T18:00', '2025-01-21T19:00', '2025-01-21T20:00', '2025-01-21T21:00', '2025-01-21T22:00', '2025-01-21T23:00'], 'relative_humidity_2m': [79, 84, 85, 85, 86, 86, 81, 78, 70, 57, 49, 42, 40, 38, 34, 35, 56, 63, 68, 69, 71, 72, 76, 60], 'cloud_cover': [42, 20, 6, 2, 98, 100, 44, 100, 100, 100, 100, 100, 100, 23, 0, 0, 0, 0, 0, 0, 11, 63, 100, 100]}

    assert parsed.daily_data == {'time': ['2025-01-21'], 'temperature_2m_max': [21.3], 'temperature_2m_min': [12.1], 'uv_index_max': [4.2]}

def test_get_from_hourly(parsed):
    assert parsed.get_cloud_cover() == [42, 20, 6, 2, 98, 100, 44, 100, 100, 100, 100, 100, 100, 23, 0, 0, 0, 0, 0, 0, 11, 63, 100, 100]

def test_get_from_daily(parsed):
    assert parsed.get_uv_index() == [4.2]
